function tma__userbar__drawWidget(){var e=document.getElementById("allrecords"),t=tma__getProfileObjFromLS(),r=tma__getPath()[0];"function"==typeof tma__createFontStyle&&tma__createFontStyle();var o=tma__userbar__getWidgetHtml(t);"members"!==r||tildaMembers.objLecture&&"page"===tildaMembers.objLecture.type?e.insertAdjacentHTML("afterend",tma__translate(o,"userbar_dict")):e.insertAdjacentHTML("beforeend",tma__translate(o,"userbar_dict")),tma__onFuncLoad("tma__profile__drawProfilePopup",function(){tma__profile__drawProfilePopup()});var a=document.querySelector(".tlk-userbar"),s=a.querySelector(".tlk-userbar__user"),r=a.querySelector(".tlk-userbar__user-image"),l=a.querySelector(".tlk-userbar__popup"),_=a.querySelector(".tlk-userbar__popup-wrap"),e=a.querySelector(".tlk-userbar__popup-edit-profile"),o=a.querySelector(".tlk-userbar__popup-logout");function i(){l.classList.remove("tlk-userbar__popup-show"),l.classList.remove("tlk-userbar__popup_bottom"),l.classList.remove("tlk-userbar__popup_left"),l.style.maxHeight=null}document.getElementById("tlk-userbar-style")||tma__userbar__createUserbarStyles(),setTimeout(function(){s.classList.add("tlk-userbar__user_scale")},300),tma__userbar__addAccordionEvents(),tma__userbar__addInputWithUserData(),r.addEventListener("click",function(){l.classList.contains("tlk-userbar__popup-show")?i():(l.classList.add("tlk-userbar__popup-show"),tma__userbar__calcCoordinatsWidgetPanel(a,l,_))}),e.addEventListener("click",i),document.addEventListener("click",function(e){e.target.closest(".tlk-userbar")||i()}),o.addEventListener("click",function(){var e=JSON.stringify({projectid:t.projectid,token:t.token});tma__request("/api/logout/",e,"",function(e){var r="tilda_members_profile"+t.projectid;localStorage.removeItem(r),localStorage.removeItem(r+"_timestamp"),document.location.replace("/members/login")})})}function tma__userbar__calcCoordinatsWidgetPanel(e,r,t){var o,a=getComputedStyle(e,null),s=+a.top.replace("px",""),l=+a.bottom.replace("px",""),e=+a.left.replace("px",""),e=+a.right.replace("px","")<e;s<l?(l=window.innerHeight)<(o=r.getBoundingClientRect()).bottom&&(t.style.maxHeight=o.height-(o.bottom-l+10)+"px"):(r.classList.add("tlk-userbar__popup_bottom"),(o=r.getBoundingClientRect()).top<0&&(t.style.maxHeight=o.height-Math.abs(o.top)-10+"px")),e||r.classList.add("tlk-userbar__popup_left")}function tma__userbar__updateDataProfile(){var e=document.querySelector(".tlk-userbar__popup-name"),r=document.querySelector(".tlk-userbar__popup-email"),t=document.querySelector(".tlk-userbar__user-image"),o=tma__getProfileObjFromLS();e.innerHTML=o.name,r.innerHTML=o.login,o.memberlogo_uuid!==tildaMembers.upload.oldId&&(t.innerHTML=tma__userbar__getLogoHtml(o)),o.memberlogo_uuid&&(tildaMembers.upload.id=o.memberlogo_uuid,tildaMembers.upload.oldId=o.memberlogo_uuid)}function tma__userbar__addAccordionEvents(){for(var e=document.querySelectorAll(".tlk-accordion"),r=0;r<e.length;r++){var t=e[r].querySelector(".tlk-accordion__link");t.classList.contains("tlk-accordion__link_not")||t.addEventListener("click",function(){var e=this,r=e.nextElementSibling;e.classList.contains("tlk-accordion__action")?(e.classList.remove("tlk-accordion__action"),r.style.maxHeight=null):(e.classList.add("tlk-accordion__action"),r.style.maxHeight=r.scrollHeight+"px")})}}function tma__userbar__getWidgetHtml(e){var r="";if(r+='<div class="tlk-userbar">',r+='<div class="tlk-userbar__user">',r+='<div class="tlk-userbar__user-notification"></div>',r+='<div class="tlk-userbar__user-image">',r+=tma__userbar__getLogoHtml(e),r+="</div>",r+="</div>",r+='<div class="tlk-userbar__popup">',r+='<div class="tlk-userbar__popup-wrap">',r+='<div class="tlk-userbar__popup-login">',r+='<div class="tlk-userbar__popup-name">'+e.name+"</div>",r+='<div class="tlk-userbar__popup-email">('+e.login+")</div>",r+='<button type="button" class="tlk-userbar__popup-edit-profile">{{widget_userbar_btn_edit_profile}}</button>',r+='<button type="button" class="tlk-userbar__popup-logout">{{widget_userbar_btn_logout}}</button>',r+="</div>",e.courses&&0<e.courses.length||e.groups&&0<e.groups.length){if(r+='<div class="tlk-userbar__popup-container">',0<e.courses.length){r+='<div class="tlk-userbar__popup-courses">',r+='<div class="tlk-userbar__popup-heading">{{widget_userbar_title_courses}}</div>';for(var t=0;t<e.courses.length;t++)r+=tma__userbar__getCourseItemHtml(e.courses[t]);r+="</div>"}if(0<e.groups.length){r+='<div class="tlk-userbar__popup-groups">',r+='<div class="tlk-userbar__popup-heading">{{widget_userbar_title_groups}}</div>';for(t=0;t<e.groups.length;t++)r+=tma__userbar__getGroupsItemHtml(e.groups[t]);r+="</div>"}r+="</div>"}return r+="</div>",r+="</div>",r+="</div>"}function tma__userbar__getCourseItemHtml(e){var r="";return r+='<div class="tlk-userbar__popup-courses-item">',r+='<div class="tlk-userbar__popup-title">',r+='<a href="/members/courses/'+e.alias+'" class="tlk-userbar__popup-courses-link" data-field="tlk-link">'+e.name+"</a>",r+="</div>",r+="</div>"}function tma__userbar__getGroupsItemHtml(e){var r="",t=0<e.pages.length&&(!e.homepage||"0"===e.homepage)&&!e.index;if(r+='<div class="tlk-userbar__popup-groups-item'+(t?" tlk-accordion":"")+'">',r+='<div class="tlk-userbar__popup-groups-title'+(t?" tlk-accordion__link":"")+'">',e.homepage&&e.index?(r+='<a href="/'+e.index+'" class="tlk-userbar__popup-groups-link" data-field="tlk-link">',r+=e.name,r+='<svg version="1.1" class="tlk-userbar__popup-groups-link-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100.2 100.2" style="enable-background:new 0 0 100.2 100.2;" xml:space="preserve">',r+="<g>",r+='<path class="st0" d="M83,47.5c-0.8,0-1.5,0.7-1.5,1.5v17.5h-49v-49H50c0.8,0,1.5-0.7,1.5-1.5s-0.7-1.5-1.5-1.5H31 c-0.8,0-1.5,0.7-1.5,1.5v13.5H17c-0.8,0-1.5,0.7-1.5,1.5v52c0,0.8,0.7,1.5,1.5,1.5h52c0.8,0,1.5-0.7,1.5-1.5V69.5H83 c0.8,0,1.5-0.7,1.5-1.5V49C84.5,48.2,83.8,47.5,83,47.5z M67.5,81.5h-49v-49h11V68c0,0.8,0.7,1.5,1.5,1.5h36.5V81.5z" />',r+='<path class="st0" d="M83,14.5H64c-0.8,0-1.5,0.7-1.5,1.5c0,0.8,0.7,1.5,1.5,1.5h15.4L54.9,41.9c-0.6,0.6-0.6,1.5,0,2.1 c0.3,0.3,0.7,0.4,1.1,0.4s0.8-0.1,1.1-0.4l24.4-24.4V35c0,0.8,0.7,1.5,1.5,1.5s1.5-0.7,1.5-1.5V16C84.5,15.2,83.8,14.5,83,14.5z" />',r+="</g>",r+="</svg>",r+="</a>"):r+=e.name,r+=e.expired?"<span> ({{widget_userbar_title_to}} "+tma__getformatDate(e.expired)+")</span>":"",r+="</div>",t){r+='<div class="tlk-userbar__popup-groups-pages tlk-accordion__content">';for(var o=0;o<e.pages.length;o++){var a=e.pages[o];r+='<div class="tlk-userbar__popup-groups-page">',r+='<a href="/'+a.link+'" class="tlk-userbar__popup-link" data-field="tlk-link">',r+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" fill="none" class="tlk-userbar__popup-groups-icon">',r+='<path d="M8.05 1H3C2.44772 1 2 1.44772 2 2V13C2 13.5523 2.44771 14 3 14H12C12.5523 14 13 13.5523 13 13V5.5M8.05 1L13 5.5M8.05 1V4.5C8.05 5.05228 8.49772 5.5 9.05 5.5H13" stroke="black"/>',r+="</svg>",r+=a.title,r+="</a>",r+="</div>"}for(o=0;o<e.docs.length;o++){var s=e.docs[o];r+='<div class="tlk-userbar__popup-groups-page">',r+='<a href="/'+s.link+'" class="tlk-userbar__popup-link" data-field="tlk-link">',r+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" fill="none" class="tlk-userbar__popup-groups-icon">',r+='<path d="M5 8.5H10M5 10.5H10M5 6.5H10M4.5 2H3C2.44772 2 2 2.44772 2 3V13C2 13.5523 2.44771 14 3 14H12C12.5523 14 13 13.5523 13 13V3C13 2.44772 12.5523 2 12 2H10.5M4.5 2V2C4.5 1.44772 4.94772 1 5.5 1H9.5C10.0523 1 10.5 1.44772 10.5 2V2M4.5 2V2.5C4.5 3.05228 4.94772 3.5 5.5 3.5H9.5C10.0523 3.5 10.5 3.05228 10.5 2.5V2" stroke="black"/>',r+="</svg>",r+=s.title,r+="</a>",r+="</div>"}r+="</div>"}return r+="</div>"}function tma__userbar__getLogoHtml(e){var r="";return e.memberlogo?r+='<img src="'+e.memberlogo+'">':(r+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60">',r+="<defs>",r+='<mask x="0" y="0" width="60" height="60">',r+="<g>",r+='<circle cx="30" cy="30" r="30" fill="#fff"></circle>',r+="</g>",r+="</mask>",r+="</defs>",r+="<g>",r+="<g>",r+='<circle cx="30" cy="30" r="30" fill-opacity="0"></circle>',r+="<g>",r+='<path class="cls-4" fill="#000" fill-opacity=".8" d="M0 0h60v60H0z"></path>',r+="</g>",r+="<g >",r+='<path class="cls-5" d="M46.68 43.83c-2-5.8-6.9-9.69-16.63-9.69s-14.58 3.77-16.84 9.69"></path>',r+="</g>",r+="<g>",r+='<circle class="cls-5" cx="30" cy="20.86" r="8.29"></circle>',r+="</g>",r+="</g>",r+="</g>",r+="</svg>"),r}function tma__userbar__createUserbarStyles(){var e=tildaMembers.settingStyles.controlblock,r="";!e||e&&Array.isArray(e)&&!e.length||((e.user_vertical_coordinate_px||e.user_horizontal_coordinate_px)&&(r+=".tlk-userbar {"),-1!==e.user_position.indexOf("top")&&e.user_vertical_coordinate_px?(r+="top: "+e.user_vertical_coordinate_px+"; ",r+="bottom: auto; "):e.user_vertical_coordinate_px&&(r+="bottom: "+e.user_vertical_coordinate_px+"; ",r+="top: auto; "),-1!==e.user_position.indexOf("left")&&e.user_horizontal_coordinate_px?(r+="left: "+e.user_horizontal_coordinate_px+"; ",r+="right: auto; "):e.user_horizontal_coordinate_px&&(r+="right: "+e.user_horizontal_coordinate_px+"; ",r+="left: auto; "),(e.user_vertical_coordinate_px||e.user_horizontal_coordinate_px)&&(r+="}"),(e.border_color||e.border_width_px)&&(r+=" .tlk-userbar__user-image {",r+="border: "+(e.border_width_px||1)+" solid "+(e.border_color||"transparent")+"; ",r+="}"),(e.user_color||e.user_border_color)&&(r+=" .tlk-userbar__user-image .cls-5 {",e.user_color&&(r+="fill: "+e.user_color+"; "),e.user_border_color&&(r+="stroke: "+e.user_border_color+"; "),r+="}"),(e.user_background||e.user_background_opacity)&&(r+=" .tlk-userbar__user-image .cls-4 {",e.user_background&&(r+="fill: "+e.user_background+"; "),e.user_background_opacity&&(r+="fill-opacity: "+ +e.user_background_opacity/100+"; "),r+="}"),(e.user_vertical_coordinate_mobile_px||e.user_horizontal_coordinate_mobile_px)&&(r+=" @media screen and (max-width: 1023px) {",r+=" .tlk-userbar {"),-1!==e.user_position_mobile.indexOf("top")&&e.user_vertical_coordinate_mobile_px?(r+="top: "+e.user_vertical_coordinate_mobile_px+"; ",r+="bottom: auto; "):e.user_vertical_coordinate_mobile_px&&(r+="bottom: "+e.user_vertical_coordinate_mobile_px+"; ",r+="top: auto; "),-1!==e.user_position_mobile.indexOf("left")&&e.user_horizontal_coordinate_mobile_px?(r+="left: "+e.user_horizontal_coordinate_mobile_px+"; ",r+="right: auto; "):e.user_horizontal_coordinate_mobile_px&&(r+="right: "+e.user_horizontal_coordinate_mobile_px+"; ",r+="left: auto; "),(e.user_vertical_coordinate_mobile_px||e.user_horizontal_coordinate_mobile_px)&&(r+="}",r+="}"),document.head.insertAdjacentHTML("beforeend",'<style id="tlk-userbar-style">'+r+"</style>"))}function tma__userbar__addInputWithUserData(){for(var e=tma__getProfileObjFromLS(),r=document.querySelectorAll(".js-form-proccess"),t=0;t<r.length;t++){var o=r[t],a=o.querySelector('input[name="ma_name"]'),s=o.querySelector('input[name="ma_email"]');a||o.insertAdjacentHTML("beforeend",'<input type="hidden" name="ma_name" value="'+e.name+'">'),s||o.insertAdjacentHTML("beforeend",'<input type="hidden" name="ma_email" value="'+e.login+'">')}}
